(function(a){a.fn.extend({overlayBox:function(c,d){var b=this;this.defaults={layoutId:"",closeBtnId:"#overlay-close",contentBlockWidth:"500",onOverlayLoaded:function(e){console.info(e)},onOverlayClosed:function(){console.info("CLOSED OVERLAY")}};this.plugin={el:undefined,options:undefined,htmlData:undefined,onOverlayLoaded:undefined,onOverlayClosed:undefined,overlayContentClass:undefined,contentBlockWidth:undefined,zIndexValue:undefined,closeBtnId:undefined,closeBtnEl:undefined,layoutEl:undefined,overlayContentEl:undefined,dataFromServer:undefined,initialize:function(){this.el=a(arguments[0]);this.options=arguments[1];this.htmlData=arguments[2];this.onOverlayLoaded=this.options.onOverlayLoaded;this.onOverlayClosed=this.options.onOverlayClosed;this.overlayContentClass="overlay-content";this.contentBlockWidth=this.options.contentBlockWidth;this.zIndexValue=this.options.zIndexValue;this.closeBtnId=this.options.closeBtnId;this.closeBtnEl=undefined;if(this.options.layoutId!==""){this.layoutEl=a("#"+this.options.layoutId)}if(a.isPlainObject(this.htmlData)){this.dataFromServer=this.htmlData.dataFromServer}this.displayOverlay()},displayOverlay:function(){var e;if(this.htmlData!==""&&this.layoutEl===undefined){e={width:a(document).width(),height:a(document).height(),zIndex:this.zIndexValue}}else{e={width:this.layoutEl.width(),height:this.layoutEl.height(),zIndex:this.zIndexValue}}this.el.css(e).fadeIn(this.displayContent())},displayContent:function(){if(typeof(this.htmlData)==="string"){this.el.append("<div class="+this.overlayContentClass+">"+this.htmlData+"</div>");this.renderContent()}else{if(this.dataFromServer!==undefined){this.getHtmlData()}else{this.renderContent()}}},renderContent:function(){if(this.closeBtnId!==undefined){this.closeBtnEl=a(this.closeBtnId)}this.addEvents();a.when(this.setCenterContent()).done(this.setCenterDone())},getHtmlData:function(){var e=this;a.ajax({beforeSend:this.generateLoader(),type:this.dataFromServer.method,dataType:this.dataFromServer.dataType,url:this.dataFromServer.url,pluginObj:this,statusCode:{404:function(){e.error_404()}}}).done(this.ajaxSuccess).fail(this.ajaxError)},generateLoader:function(){this.el.append("<div class="+this.overlayContentClass+"><img src="+this.dataFromServer.loaderIcon+' alt="" id='+this.dataFromServer.loaderId+" /></div>")},ajaxSuccess:function(h){var g=this.pluginObj,e,f=g.el.find("#"+g.dataFromServer.loaderId);f.after("<div class='loaded-content serverdata'>"+h+"</div>");e=g.el.find(".loaded-content");g.renderContent();f.fadeOut(function(){a(this).remove();e.fadeIn()})},ajaxError:function(e){console.info(e)},error_404:function(){var e=this.el.find("#"+this.dataFromServer.loaderId);e.after("<div class='error-content serverdata'>"+this.dataFromServer.error_404_html+"</div>");loadedContentEl=this.el.find(".error-content");this.renderContent();e.fadeOut(function(){a(this).remove();loadedContentEl.fadeIn()})},setCenterContent:function(){var i,h,g,f,e=this.el.find("."+this.overlayContentClass);if(typeof(this.htmlData)==="object"&&this.dataFromServer===undefined){this.overlayContentEl=e.eq(parseInt(this.htmlData.data("overlay-btn-id"))-1)}else{this.overlayContentEl=e.eq(0)}f=(this.overlayContentEl.children(".serverdata").size()>0)?this.dataFromServer.loadedContentHeight:this.overlayContentEl.height();i=(this.el.height()-f)/2;h=(this.el.width()-this.contentBlockWidth)/2;g=a(document).scrollTop();if(g>0){i=g+this.overlayContentEl.height()/4}this.overlayContentEl.css({margin:"0 auto",position:"absolute",top:i,left:h,width:this.contentBlockWidth+"px"})},setCenterDone:function(){this.overlayContentEl.css({display:"block"});this.el.trigger("onOverlayLoaded")},hideOverlay:function(f){f.preventDefault();f.stopPropagation();var g=f.data.obj;if(f.keyCode===27||f.target.id==="overlay"||f.target.id===g.closeBtnId.split("#")[1]){g.el.fadeOut(function(){g.animateHideCallback(g)})}},animateHideCallback:function(e){if(typeof(e.htmlData)==="string"||e.dataFromServer!==undefined){e.overlayContentEl.remove()}else{e.overlayContentEl.css({display:"none"})}e.el.css({width:0,height:0,zIndex:0});e.removeEvents();if(typeof(e.onOverlayClosed)==="function"){e.onOverlayClosed()}},runOverlayLoaded:function(f){var g=f.data.obj;if(typeof(g.onOverlayLoaded)==="function"){g.onOverlayLoaded(g.overlayContentEl)}},addEvents:function(){if(this.closeBtnEl!==undefined){this.closeBtnEl.on({"click.overlayEvent":this.hideOverlay},{obj:this})}a(window).on({"keydown.overlayEvent":this.hideOverlay},{obj:this});this.el.on({"onOverlayLoaded.overlayEvent":this.runOverlayLoaded,"click.overlayEvent":this.hideOverlay},{obj:this})},removeEvents:function(){var e=".overlayEvent";this.el.off(e);a(window).off(e);if(this.closeBtnEl.size()>0){this.closeBtnEl.off(e)}}};this.init=function(e){a.proxy(b.plugin.initialize(this,e,d),b.plugin)};constructor=function(){b.options=a.extend(b.defaults,c);b.init(b.options)}()}})})(jQuery);